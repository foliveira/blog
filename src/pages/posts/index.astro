---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts", ({ data }) => !data.draft)).sort(
    (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);
---

<BaseLayout title="Posts" description="Browse all posts">
    <section>
        <h1>All Posts</h1>
        <p class="muted">
            {posts.length}
            {posts.length === 1 ? "post" : "posts"}
        </p>

        <ul class="list" aria-label="All posts">
            {
                posts.map((p) => (
                    <li class="list-item">
                        <div class="caps">
                            <time datetime={p.data.date.toISOString()}>
                                {p.data.date.toLocaleDateString(undefined, {
                                    year: "numeric",
                                    month: "short",
                                    day: "2-digit",
                                })}
                            </time>
                        </div>
                        <h3 style="margin:.25rem 0;">
                            <a href={`/posts/${p.slug}`}>{p.data.title}</a>
                        </h3>
                        {p.data.description && (
                            <p class="muted" style="margin:.35rem 0 0;">
                                {p.data.description}
                            </p>
                        )}
                        {p.data.tags?.length ? (
                            <p class="muted" style="margin:.35rem 0 0;">
                                Tags: {p.data.tags.join(", ")}
                            </p>
                        ) : null}
                    </li>
                ))
            }
        </ul>
    </section>
</BaseLayout>
